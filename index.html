<!DOCTYPE html>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<style>
	@font-face {
		font-family:wechatSans;
		src:url("https://images.orangejuice.top/fonts/WeChatSansStd-Bold.ttf");
	}
	h1{
		
		font-size: 56;
		color: gold;
		text-align: center;
	}
	#target{
		margin: 10px;
		padding-top: 150px;
		font-size: 80px;
		font-family: wechatSans;
		font-weight: 50;
		color: #f9d3a6;
		height: 350px;
		text-align: center;	
	}
	#bg{
		margin: 10px;
		height: 400px;
		background-color: #f45f4d;
	}
	input{
		margin-left: 10px;
	}
	#model{
		border: lightslategray 1px solid;
		border-radius: 20px;
		padding: 10px;
		width:450px;
	}
	#tip{
		font-size: small;
	}
	#yuan{
		font-size:large;
	}
	#tucao{
		font-size: x-small;
		
	}
</style>	
<div id="model">
	<div>
		<input id="input" placeholder="å¯¹æˆ‘è¾“å…¥é‡‘é¢ï¼ˆä¾‹ï¼š100.00ï¼‰" />
		<button onclick="downloadHandler()">ç”Ÿæˆ&ä¸‹è½½</button><span id="tip"> â—é‡‘é¢æœ€å¤§7ä½,å°æ•°ç‚¹å 1</span>
		<br>
		<input type="radio" name="type" id="option1" checked="checked">ï¿¥+æ•°å­—</input>
		<input type="radio" name="type" id="option2">æ•°å­—+å…ƒ</input>
	</div>
	<hr/>
	<div id="bg">
		<div id="target">
			å•¥éƒ½æ²¡æœ‰?
		</div>
	</div>
	<hr/>
	<span id="tucao">-tucao-</span>
	
</div>
<script type="text/javascript">
	const Type = {
	    null: 0,
	    toomuch: 1,
	    tucao: 2
	}
	var downloadHandler = function(){
		var num = document.getElementById("input").value;
		if(num!="" && !isNaN(num)){
			if(num.length<8){
				//æ ¹æ®lengthè‡ªé€‚åº”
				adaptSize(num.length);
				//num = parseFloat(num).toFixed(2);
				if(document.getElementById("option1").checked){
					document.getElementById("target").innerText = "ï¿¥"+num;
				}
				if(document.getElementById("option2").checked){
					document.getElementById("target").innerHTML = num + '<span id="yuan">å…ƒ</span>';
				}
				gen2down(num);  
				tucao();
			}
			else{
				inputTooMuch();
			}
		}else{
			inputNull();
		}
	}

	var adaptSize = function(length){
		var target = document.getElementById("target");
		// length<=3 font-size: 150px; padding-top: 80px;
		if(length<=3){
			target.style = "font-size: 150px; padding-top: 80px;";
		// 6>length>3 font-size: 100px; padding-top: 130px;
		}else if(length<6){
			target.style = "font-size: 100px; padding-top: 110px;";
		// length>6 default font-size: 80px; padding-top: 150px;
		}else{
			target.style = "font-size: 80px; padding-top: 130px;";
		}
	}
	var gen2down = function(num){
		//åˆ›å»ºä¸€ä¸ªæ–°çš„canvas
		var canvas2 = document.createElement("canvas");
		let _canvas = document.querySelector('#target');
		var w = parseInt(window.getComputedStyle(_canvas).width);
		var h = parseInt(window.getComputedStyle(_canvas).height);
		//å°†canvasç”»å¸ƒæ”¾å¤§è‹¥å¹²å€ï¼Œç„¶åç››æ”¾åœ¨è¾ƒå°çš„å®¹å™¨å†…ï¼Œå°±æ˜¾å¾—ä¸æ¨¡ç³Šäº†
		canvas2.width = w * 2;
		canvas2.height = h * 2;
		canvas2.style.width = w + "px";
		canvas2.style.height = h + "px";
		//å¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚ï¼Œå¯¹contextçš„å‚æ•°ä¿®æ”¹,translateæŒ‡çš„æ˜¯åç§»é‡
		//  var context = canvas.getContext("2d");
		//  context.translate(0,0);
		var context = canvas2.getContext("2d");
		context.scale(2, 2.1);
		context.translate(0,-0.5);
		html2canvas(document.querySelector('#target'), { canvas: canvas2,backgroundColor:null }).then(function(canvas) {
		    //canvasè½¬æ¢æˆurlï¼Œç„¶ååˆ©ç”¨aæ ‡ç­¾çš„downloadå±æ€§ï¼Œç›´æ¥ä¸‹è½½ï¼Œç»•è¿‡ä¸Šä¼ æœåŠ¡å™¨å†ä¸‹è½½
			var imgUri = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream"); // è·å–ç”Ÿæˆçš„å›¾ç‰‡çš„url
			var fileName = num+".png";
			var link = document.createElement('a');
			    link.setAttribute('download', fileName);
			    link.setAttribute('href', imgUri);
			    link.click();
		});
	}
	var inputNull = function(){
		document.getElementById("target").innerText = stringKeeper(Type.null);
	}
	var inputTooMuch = function(){
		document.getElementById("target").innerText = stringKeeper(Type.toomuch);
	}
	var tucao = function(){
		document.getElementById("tucao").innerText = '-'+stringKeeper(Type.tucao)+'-';
	}
	//é›†ä¸­å¤„ç†è¯­æ–™
	var stringKeeper = function(type){
		var nullArray=["è¿™æ˜¯æ•°å­—ï¼Ÿ","æœ‰ç—…ï¼Ÿ","è„‘å­è¿˜åœ¨ï¼Ÿ","å•Šï¼Ÿ","...","æ¸…é†’ä¸€ç‚¹ï¼","æ‡‚äººè¨€å¦ï¼Ÿ","æ•°å­—ï¼å•Šï¼","è¿™æœ‰æ•°å­—ï¼Ÿ"];
		var tooMuchArray=["å¤ªè´ªå¿ƒä¹Ÿä¸å¥½","ä½ æœ‰è¿™ä¹ˆå¤šé’±ï¼Ÿ","å¯Œå“¥V50","å¾ˆéš¾æ’‘","è¿™ä¸åˆç†å§","è¿™ä¹Ÿä¸åˆé€‚å§"];
		var tucaoArray=["å¸Œæœ›ä½ çœŸæœ‰è¿™ä¹ˆå¤šé’±ï¼","èƒ½ä¸èƒ½åˆ†æˆ‘ç‚¹ï¼Ÿ","è¿™æ•°å­—æœ‰ä»€ä¹ˆå«ä¹‰ï¼Ÿ","å¸Œæœ›ä½ ç©çš„æ„‰å¿«ğŸ˜€ï¼","æ„Ÿè°¢ä½¿ç”¨ğŸ˜Šï¼å–œæ¬¢è¯·ç‚¹èµï¼"];
		var types = [nullArray,tooMuchArray,tucaoArray];
		//é™åˆ¶åœ¨10å¥è¯ä¹‹å†…
		var index = Math.floor(Math.random()*10+1)%types[type].length;
		return types[type][index];
	}
</script>
